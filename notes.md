[TOC]

# 1. Introduction

> **Portfolio optimization** is the process of selecting the best portfolio (asset distribution), out of the set of all portfolios being considered, according to some objective. 

The objective typically maximizes factors such as the *expected return*, and minimized costs like *financial risk*. These factors could be:

- tangible, like assets, liabilities, earning or other **fundamentals**.
- intangible, like selective divestment.

## 1.1 Modern Portfolio Theory

The modern portfolio theory was introduced in 1952 by Markowitz, with the [*Markowitz model*](https://en.wikipedia.org/wiki/Utility_maximization_problem). It assumes that an investor wants to maximize a portfolio's expected  return contingent on any given amount of risk. For portfolios that meet  this criterion, known as efficient portfolios, achieving a higher  expected return requires taking on more risk, so investors are faced  with a trade-off between risk and expected return. This risk-expected return relationship of efficient portfolios is graphically represented  by a curve known as the efficient frontier. 

### 1.1.1 Efficient frontier

A portfolio is referred to as efficient if it has the best possible expected level of return for its level of risk, conveniently represented by the standard deviation of the portfolio's return. Here, every possible combination of risky assets can be plotted in risk-expected return space, and the collection of all such possible portfolios defines a region in this space. In the absence of the opportunity to hold a risk-free asset, this region is the opportunity set (the **feasible set)**. The positively sloped top boundary of this region is a portion of a hyperbola and is called the efficient frontier.

![img](https://upload.wikimedia.org/wikipedia/commons/e/e1/Markowitz_frontier.jpg)

If a risk-free asset is also available, the opportunity set is larger, and its upper boundary, the efficient frontier, is a straight line  segment emanating from the vertical axis at the value of the risk-free  asset's return and tangent to the risky-assets-only opportunity set. All portfolios between the risk-free asset and the tangency portfolio are  portfolios composed of risk-free assets and the tangency portfolio,  while all portfolios on the linear frontier above and to the right of  the tangency portfolio are generated by borrowing at the risk-free rate and investing the proceeds into the tangency portfolio.

### 1.1.2 Optimization methods

The portfolio optimization problem can be specified as a [**constrained utility-maximization problem**](https://en.wikipedia.org/wiki/Utility_maximization_problem). In such problems exists a formulation for the utility functions, commonly it the difference of the expected portfolio return (net of transaction and financing costs) minus a cost of risk.  The latter component, is defined as the portfolio risk multiplied by a **risk aversion** parameter, or unit price of risk. Often some constraints to improve diversification could be added, such as asset, sector, and region portfolio weight limits.

The optimization process takes place in two stages:

1. optimizing weights of asset classes to hold, i.e., choosing the proportions placed in equities versus bonds.
2. optimizing weights of assets within the same asset class, i.e., choosing the proportions of the stock sub-portfolio placed in stocks X, Y, Z. 

Investors are exposed to two types of risk: *unsystematic risk* and *systematic risk*. Unsystematic risk is an assetâ€™s intrinsic risk which can be diversified away by owning a large number of assets. These risks do not present enough information about the overall risk of the entire portfolio. Systematic risk, or the portfolio risk, is the risk generally associated with the market which cannot be eliminated. 

Having different classes in a Portfolio provides some diversification. Using this 2-way procedure eliminates non-systematic risks both on the individual asset and the asset-class level.

> ### 1.1.2.1 Portfolio separation in mean-variance analysis
>
> Portfolios can be analyzed in a mean-variance framework, with every investor holding the portfolio with the lowest possible return variance consistent with that investor's chosen level of expected return (the so-called minimum-variance portfolio).
>
> Under mean-variance analysis, it can be shown that every minimum-variance portfolio given a particular expected return (that is, every efficient portfolio) can be formed as a combination of any two efficient portfolios.  If the investor's optimal portfolio has an expected return that is between the expected returns on two efficient benchmark portfolios, then that investor's portfolio can be characterized as consisting of positive quantities of the two benchmark portfolios.
>
> To see two-fund separation in a context in which no risk-free asset is available, where:
>
> - $\sigma^2$ is the portfolio's variance, defined as $\sigma^2 = X^T\Sigma X$ where $\Sigma$ is a positive definite covariance matrix of the individual assets returns.
> - $\mu$ is the expected return on the portfolio,
> - $r$ is a vector of expected returns on the available assets,
> - $X$ is a vector of amounts to be placed in the assets,
> - $W$ is the amount of wealth to be allocated in the portfolio.
>
> The problem of minimizing the portfolio return variance subject to a given level of expected portfolio return can be stated as
> $$
> \begin{aligned}
>         \min_X \quad & \sigma^2\\
>         \textrm{s.t.} \quad & X^Tr=\mu\\
>         & X^T\mathbf{1} = W
> \end{aligned}
> $$
> The Lagrangian for this constrained optimization problem is 
> $$
> \mathcal{L} = X^T\Sigma X + 2\lambda (\mu - X^Tr)+2\eta (W - X^T \mathbf{1})
> $$
> This can be solved for the optimal vector $X$ of asset quantities by equating to zero the derivatives with respect to $X$, $\lambda$ and $\eta$. The result is 
> $$
> X^* = \alpha W + \beta \mu
> $$
>  where $\alpha$ and $\beta$ are parameter vector based on the underlying model parameters.

Markowitz has developed the *critical line method*, which is a general procedure for quadratic programming that can handle additional linear constraints and upper and lower bounds on holdings. In this context, the sudden approach provides a method for determining the entire set of efficient portfolios. 

### 1.1.3 Optimization Constraints

Portfolio optimization is usually done subject to constraints, such as regulatory constraints, or illiquidity. These constraints can lead to portfolio weights that focus on a small sub-sample of assets within the  portfolio. When the portfolio optimization process is subject to other constraints such as taxes, transaction costs, and management fees, the  optimization process may result in an under-diversified portfolio.

## 1.2 Improving Portfolio optimization

Different approaches to portfolio optimization measure risk differently. In addition to the traditional measure, which uses the standard deviation or the variance, which are not robust enough, one could use Sortino Ratio, CVaR, and statistical dispersion.

Investment is a forward-looking activity, and this the covariances of returns must be forecast rather than observed.

Portfolio optimization assumes the investor may have some risk aversion and the stock prices may exhibit significant differences between their historical or forecast values and what is experienced.  

# 2. The Critical Line Method

The gradient method works well for solving the *standard asset allocation problem*:
$$
\begin{aligned}
        \max_X \quad & u = \mu - \dfrac{\sigma^2}{rt}\\
        \textrm{s.t.} \quad & X^Tr=\mu\\
        & X^T\Sigma X=\sigma^2\\
        & X^T\mathbf{1} = W \\
        & X \geq lb \\
        & X \leq ub
\end{aligned}
$$
where $u$ is the measure of the portfolio's utility, which can be interpreted as a *risk-adjusted expected return,* computed by subtracting a risk penalty ($\frac{\sigma^2}{rt}$) from the expected return $\mu$.  Here, $rt$ represents the investor's *marginal rate of substitution of variance for expected value*.

Note that this involves the maximization of a *quadratic function* of the decision variables, subject to a set of *linear constraints*, some of which are *inequalities*. A problem with such characteristics is termed a *quadratic programming* (QP) problem. It may be solved with a general quadratic programming algorithm or with a procedure designed to deal only with problems that have similar structures. 

If there are no bounds on holdings, cases with additional linear constraints can be solved directly.  Markowitz developed a general procedure that can handle additional linear constraints and upper and lower bounds on holdings. Moreover, the approach provides a method for determining the entire set of efficient portfolios. 

## 2.1 Adding Linear Inequalities

The standard problem involves two sets of constraints. The first requires the sum of the proportions over $n$ assets to be equal to a constant:
$$
X^T\mathbf{1} = \sum x_i = W
$$
and the second to require that the proportions remain in some specified bounds:
$$
	\forall i \in \{1, \dots, n\}: x_i \geq lb \land x_i \leq ub
$$
We can generalize the first constraint to allow for any desired number of constraints as long as they are linear in the variables. Given such $m$ constraints, we require that:
$$
Ax = b
$$
where $A \in \R^{m \times n}$ is a matrix with the left-hand side coefficients of the constraints and $b \in \R^{m}$ is a vector of the right-hand sides of the constraints. The **full-investment constraints**, $W = 1$, requires that $m = 1$ and all the coefficients in $A$ and $b$ are equal to $1.0$. 

Linear equality constraints may be of some interest in their own right, but in most practical cases they are not. By combining a linear equality with bounds on a variable one can constrain a linear function of the asset holdings to be within desired bounds.

To illustrate, consider a 3 asset case in which the maximum weight to be invested in cash plus bonds to $40%$ of the overall portfolio. To do so, we introduce a new variable to represent the sum of the amounts, so $X_4 = X_1 + X_2$, and add a second equation to the constraint set:

```
A = [1	1	1	0
	 1	1	0  -1]
b = [1
	 0]
```

In the first, the full-investment constraint, the fourth variable has coefficient zero, since it is not an investment per se. To restrict the amount invested in the sum of the two asset classes to be less than 40% of the portfolio, we need only to assign the appropriate values for the bounds on variable 4. In this case:

```
lb = [0
	  0
	  0
	  0]
	  
lb = [1
	  1
	  1
	  0.4]
```

## 2.2 Parametric General Asset Allocation Problem

The parametric general asset allocation problem has the form:
$$
\begin{aligned}
        \max_X \quad & u = \mu - \dfrac{\sigma^2}{rt}\\
        \textrm{s.t.} \quad & X^Tr=\mu\\
        & X^T\Sigma X=\sigma^2\\
        & X^T\mathbf{1} = W \\
        & X \geq lb \\
        & X \leq ub \\
        & \forall rt >0
\end{aligned}
$$
The solution to the parametric version will be a matrix of portfolios rather than a single portfolio, by varying the values of $rt$. 

To illustrate, consider a portfolio where the assets are cash, bonds and stocks, with expected returns, risks and correlations:

```
    mean =
        2.8000
        6.3000
       10.8000

    standard_deviation =
        1.0000
        7.4000
       15.4000

    covariance =
        1.0000    0.4000    0.1500
        0.4000    1.0000    0.3500
        0.1500    0.3500    1.0000
```

We assume that is required that at least $20\%$ of the portfolio be invested in each of the assets and that no more than $50\%$ of the portfolio be invested in any asset. Thus:

```
lb =
    0.2000
    0.2000
    0.2000

ub =
    0.5000
    0.5000
    0.5000
```

Then we have to find all the portfolios which are efficient by maximizing the utility for every non-negative value of the risk tolerance.
